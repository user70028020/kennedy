import{f,a as x,c as ze}from"../chunks/BVSBLeZ4.js";import{p as Ee,s as v,h as ce,u as Ue,f as $t,c as r,d as a,t as L,g as t,a as Be,b as s,r as e,j as Pe}from"../chunks/CyUuy-wj.js";import{d as Fe,s as i}from"../chunks/Ds7I-RoO.js";import{i as V}from"../chunks/B9KgWSyi.js";import{e as Gt,i as qt}from"../chunks/D5Lyc911.js";import{r as ve,s as Ne}from"../chunks/BUYgxnM0.js";import{s as Jt}from"../chunks/DwPpHslU.js";import{s as Oe}from"../chunks/SJb4weSm.js";import{b as pe}from"../chunks/BZWVT1Ld.js";import{b as Kt}from"../chunks/axbQqOQH.js";import{b as ue}from"../chunks/c2Jz6SHd.js";import{a as me}from"../chunks/CLPOYvp8.js";import{b as Ve}from"../chunks/DxC-crzK.js";import{s as He,f as $e}from"../chunks/DdEIAL_0.js";var Ge=f("<option> </option>"),qe=f('<div class="bg-red-500/20 border border-red-500 text-red-400 px-4 py-3 rounded-lg animate-fade-in"> </div>'),Je=f('<div class="p-8 text-center"><div class="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> <p class="text-theme-muted">Carregando logs...</p></div>'),Ke=f('<div class="p-8 text-center"><svg class="w-12 h-12 mx-auto mb-4 text-theme-muted opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <p class="text-theme-muted">Nenhum log de auditoria encontrado</p></div>'),Qe=f('<tr class="transition-colors duration-200 hover:bg-theme-hover" style="opacity: 0;"><td class="px-4 py-3 whitespace-nowrap"><div class="text-theme-primary text-sm"> </div> <div class="text-theme-muted text-xs"> </div></td><td class="px-4 py-3 whitespace-nowrap"><div class="flex items-center gap-2"><div class="w-7 h-7 bg-blue-600 rounded-full flex items-center justify-center"><span class="text-white text-xs font-medium"> </span></div> <span class="text-theme-primary text-sm"> </span></div></td><td class="px-4 py-3 whitespace-nowrap"><span> </span></td><td class="px-4 py-3 whitespace-nowrap text-theme-secondary text-sm"> </td><td class="px-4 py-3"><div class="text-theme-secondary text-sm max-w-xs truncate"> </div></td><td class="px-4 py-3 whitespace-nowrap text-theme-muted text-sm font-mono"> </td><td class="px-4 py-3 whitespace-nowrap text-right"><button class="p-2 text-theme-muted hover:text-blue-400 transition-colors duration-200" title="Ver detalhes"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg></button></td></tr>'),We=f("<button> </button>"),Xe=f('<div class="px-4 py-3 flex items-center justify-between" style="background-color: var(--bg-tertiary);"><button class="px-3 py-1 rounded transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105" style="background-color: var(--bg-secondary); color: var(--text-secondary);">Anterior</button> <div class="flex items-center gap-1"></div> <button class="px-3 py-1 rounded transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105" style="background-color: var(--bg-secondary); color: var(--text-secondary);">Próximo</button></div>'),Ye=f('<div class="overflow-x-auto"><table class="w-full"><thead style="background-color: var(--bg-tertiary);"><tr><th class="px-4 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Data/Hora</th><th class="px-4 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Usuário</th><th class="px-4 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Ação</th><th class="px-4 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Recurso</th><th class="px-4 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Detalhes</th><th class="px-4 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">IP</th><th class="px-4 py-3 text-right text-xs font-medium text-theme-secondary uppercase tracking-wider">Ações</th></tr></thead><tbody class="divide-y" style="border-color: var(--border-color);"></tbody></table></div> <!>',1),Ze=f('<div><span class="text-sm text-theme-muted">ID do Recurso</span> <p class="text-theme-primary font-mono text-sm"> </p></div>'),tr=f('<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in"><div class="rounded-lg w-full max-w-lg animate-scale-in" style="background-color: var(--bg-card); border: 1px solid var(--border-color);"><div class="p-6 flex items-center justify-between" style="border-bottom: 1px solid var(--border-color);"><h2 class="text-xl font-semibold text-theme-primary">Detalhes do Log</h2> <button class="p-2 text-theme-muted hover:text-theme-primary transition-colors duration-200" aria-label="Fechar modal"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-6 space-y-4"><div><span class="text-sm text-theme-muted">ID do Log</span> <p class="text-theme-primary font-mono text-sm"> </p></div> <div><span class="text-sm text-theme-muted">Data e Hora</span> <p class="text-theme-primary"> </p></div> <div><span class="text-sm text-theme-muted">Usuário</span> <div class="flex items-center gap-2 mt-1"><div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center"><span class="text-white text-sm font-medium"> </span></div> <div><p class="text-theme-primary"> </p> <p class="text-theme-muted text-xs font-mono"> </p></div></div></div> <div><span class="text-sm text-theme-muted">Ação</span> <p class="mt-1"><span> </span></p></div> <div><span class="text-sm text-theme-muted">Tipo de Recurso</span> <p class="text-theme-primary"> </p></div> <!> <div><span class="text-sm text-theme-muted">Detalhes</span> <p class="text-theme-primary rounded-lg p-3 mt-1" style="background-color: var(--bg-secondary);"> </p></div> <div><span class="text-sm text-theme-muted">Endereço IP</span> <p class="text-theme-primary font-mono"> </p></div></div> <div class="p-6" style="border-top: 1px solid var(--border-color);"><button class="w-full px-4 py-2 rounded-lg transition-all duration-200 hover:scale-[1.02]" style="background-color: var(--bg-tertiary); color: var(--text-secondary);">Fechar</button></div></div></div>'),er=f('<div class="space-y-6" style="opacity: 0;"><div><h1 class="text-2xl font-bold text-theme-primary">Auditoria e Segurança</h1> <p class="text-theme-muted mt-1">Visualize todas as ações realizadas no sistema</p></div> <div class="rounded-lg p-4 border transition-colors duration-300" style="background-color: var(--bg-card); border-color: var(--border-color);"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4"><div><label for="startDate" class="block text-sm font-medium text-theme-secondary mb-1">Data Início</label> <input type="date" id="startDate" class="w-full px-3 py-2 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-primary);"/></div> <div><label for="endDate" class="block text-sm font-medium text-theme-secondary mb-1">Data Fim</label> <input type="date" id="endDate" class="w-full px-3 py-2 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-primary);"/></div> <div><label for="userId" class="block text-sm font-medium text-theme-secondary mb-1">Usuário</label> <select id="userId" class="w-full px-3 py-2 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-primary);"><option>Todos</option><!></select></div> <div><label for="action" class="block text-sm font-medium text-theme-secondary mb-1">Ação</label> <select id="action" class="w-full px-3 py-2 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-primary);"><option>Todas</option><option>Login</option><option>Logout</option><option>Criar</option><option>Atualizar</option><option>Excluir</option><option>Download</option><option>Gerar</option></select></div> <div><label for="resourceType" class="block text-sm font-medium text-theme-secondary mb-1">Tipo de Recurso</label> <select id="resourceType" class="w-full px-3 py-2 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-primary);"><option>Todos</option><option>Usuário</option><option>Relatório</option><option>Template</option><option>Ordem de Serviço</option><option>Mesclagem</option></select></div></div> <div class="flex justify-end gap-3 mt-4"><button class="px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105" style="background-color: var(--bg-tertiary); color: var(--text-secondary);">Limpar Filtros</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 hover:scale-105 hover:shadow-lg hover:shadow-blue-600/25"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Filtrar</button></div></div> <!> <div class="flex items-center justify-between text-sm text-theme-muted"><span> </span> <span> </span></div> <div class="rounded-lg overflow-hidden border transition-colors duration-300" style="background-color: var(--bg-card); border-color: var(--border-color);"><!></div></div> <!>',1);function _r(xe,_e){Ee(_e,!0);const X={login:{label:"Login",color:"bg-green-500/20 text-green-400"},logout:{label:"Logout",color:"bg-gray-500/20 text-gray-400"},create:{label:"Criar",color:"bg-blue-500/20 text-blue-400"},update:{label:"Atualizar",color:"bg-yellow-500/20 text-yellow-400"},delete:{label:"Excluir",color:"bg-red-500/20 text-red-400"},download:{label:"Download",color:"bg-purple-500/20 text-purple-400"},generate:{label:"Gerar",color:"bg-cyan-500/20 text-cyan-400"}},Qt={user:"Usuário",report:"Relatório",template:"Template",service_order:"Ordem de Serviço",merge:"Mesclagem"};let ct=v(ce([])),vt=v(0),pt=v(!0),Y=v(null),Wt=v(ce([])),Z,tt=[],H=v(""),$=v(""),G=v(""),q=v(""),J=v(""),u=v(1),ut=20,mt=v(!1),d=v(null),Xt=v(!1);Ue(()=>{Ve&&!t(Xt)&&(s(Xt,!0),Z&&$e(Z,{duration:.4}),be(),et())});async function be(){try{s(Wt,await me.get("/admin/users"),!0)}catch(o){console.error("Error loading users:",o)}}async function et(){s(pt,!0),s(Y,null);try{const o=new URLSearchParams;t(H)&&o.append("startDate",t(H)),t($)&&o.append("endDate",t($)),t(G)&&o.append("userId",t(G)),t(q)&&o.append("action",t(q)),t(J)&&o.append("resourceType",t(J)),o.append("limit",ut.toString()),o.append("offset",((t(u)-1)*ut).toString());const n=o.toString(),c=await me.get(`/admin/audit-logs${n?"?"+n:""}`);s(ct,c.logs,!0),s(vt,c.total,!0),setTimeout(()=>{tt.length>0&&He(tt.filter(Boolean),{duration:.2,stagger:.03})},100)}catch(o){s(Y,o instanceof Error?o.message:"Erro ao carregar logs de auditoria",!0)}finally{s(pt,!1)}}function ge(){s(u,1),et()}function fe(){s(H,""),s($,""),s(G,""),s(q,""),s(J,""),s(u,1),et()}function xt(o){s(u,o,!0),et()}function he(o){s(d,o,!0),s(mt,!0)}function Yt(){s(mt,!1),s(d,null)}function ye(o){return new Date(o).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function we(o){return new Date(o).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}function ke(o){return new Date(o).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}let j=Pe(()=>Math.ceil(t(vt)/ut));var Zt=er(),rt=$t(Zt),_t=a(r(rt),2),bt=r(_t),gt=r(bt),te=a(r(gt),2);ve(te),e(gt);var ft=a(gt,2),ee=a(r(ft),2);ve(ee),e(ft);var ht=a(ft,2),yt=a(r(ht),2),wt=r(yt);wt.value=wt.__value="";var De=a(wt);Gt(De,17,()=>t(Wt),qt,(o,n)=>{var c=Ge(),S=r(c,!0);e(c);var I={};L(()=>{i(S,t(n).name),I!==(I=t(n).id)&&(c.value=(c.__value=t(n).id)??"")}),x(o,c)}),e(yt),e(ht);var kt=a(ht,2),Dt=a(r(kt),2),Tt=r(Dt);Tt.value=Tt.__value="";var Lt=a(Tt);Lt.value=Lt.__value="login";var St=a(Lt);St.value=St.__value="logout";var At=a(St);At.value=At.__value="create";var Mt=a(At);Mt.value=Mt.__value="update";var jt=a(Mt);jt.value=jt.__value="delete";var It=a(jt);It.value=It.__value="download";var re=a(It);re.value=re.__value="generate",e(Dt),e(kt);var ae=a(kt,2),Rt=a(r(ae),2),Ct=r(Rt);Ct.value=Ct.__value="";var zt=a(Ct);zt.value=zt.__value="user";var Et=a(zt);Et.value=Et.__value="report";var Ut=a(Et);Ut.value=Ut.__value="template";var Bt=a(Ut);Bt.value=Bt.__value="service_order";var oe=a(Bt);oe.value=oe.__value="merge",e(Rt),e(ae),e(bt);var se=a(bt,2),ie=r(se);ie.__click=fe;var Te=a(ie,2);Te.__click=ge,e(se),e(_t);var le=a(_t,2);{var Le=o=>{var n=qe(),c=r(n,!0);e(n),L(()=>i(c,t(Y))),x(o,n)};V(le,o=>{t(Y)&&o(Le)})}var Pt=a(le,2),Ft=r(Pt),Se=r(Ft);e(Ft);var ne=a(Ft,2),Ae=r(ne);e(ne),e(Pt);var de=a(Pt,2),Me=r(de);{var je=o=>{var n=Je();x(o,n)},Ie=o=>{var n=ze(),c=$t(n);{var S=h=>{var k=Ke();x(h,k)},I=h=>{var k=Ye(),R=$t(k),at=r(R),C=a(r(at));Gt(C,21,()=>t(ct),qt,(y,l,w)=>{var _=Qe(),D=r(_),b=r(D),m=r(b,!0);e(b);var p=a(b,2),T=r(p,!0);e(p),e(D);var z=a(D),E=r(z),U=r(E),B=r(U),Ot=r(B,!0);e(B),e(U);var P=a(U,2),st=r(P,!0);e(P),e(E),e(z);var K=a(z),F=r(K),Vt=r(F,!0);e(F),e(K);var A=a(K),it=r(A,!0);e(A);var Q=a(A),N=r(Q),lt=r(N,!0);e(N),e(Q);var W=a(Q),nt=r(W,!0);e(W);var dt=a(W),M=r(dt);M.__click=()=>he(t(l)),e(dt),e(_),ue(_,(g,O)=>tt[O]=g,g=>tt?.[g],()=>[w]),L((g,O,Ht)=>{i(m,g),i(T,O),i(Ot,Ht),i(st,t(l).userName),Jt(F,1,`px-2 py-1 text-xs rounded-full ${(X[t(l).action]?.color||"bg-gray-500/20 text-gray-400")??""}`),i(Vt,X[t(l).action]?.label||t(l).action),i(it,Qt[t(l).resourceType]||t(l).resourceType),Ne(N,"title",t(l).details),i(lt,t(l).details),i(nt,t(l).ipAddress||"-")},[()=>we(t(l).timestamp),()=>ke(t(l).timestamp),()=>t(l).userName.charAt(0).toUpperCase()]),x(y,_)}),e(C),e(at),e(R);var ot=a(R,2);{var Nt=y=>{var l=Xe(),w=r(l);w.__click=()=>xt(t(u)-1);var _=a(w,2);Gt(_,21,()=>Array.from({length:Math.min(5,t(j))},(b,m)=>{const p=Math.max(1,t(u)-2),T=Math.min(t(j),p+4);return Math.max(1,T-4)+m}).filter(b=>b<=t(j)),qt,(b,m)=>{var p=We();p.__click=()=>xt(t(m));var T=r(p,!0);e(p),L(()=>{Jt(p,1,`px-3 py-1 rounded transition-all duration-200 ${t(m)===t(u)?"bg-blue-600 text-white":""}`),Oe(p,t(m)!==t(u)?"background-color: var(--bg-secondary); color: var(--text-secondary);":""),i(T,t(m))}),x(b,p)}),e(_);var D=a(_,2);D.__click=()=>xt(t(u)+1),e(l),L(()=>{w.disabled=t(u)===1,D.disabled=t(u)===t(j)}),x(y,l)};V(ot,y=>{t(j)>1&&y(Nt)})}x(h,k)};V(c,h=>{t(ct).length===0?h(S):h(I,!1)},!0)}x(o,n)};V(Me,o=>{t(pt)?o(je):o(Ie,!1)})}e(de),e(rt),ue(rt,o=>Z=o,()=>Z);var Re=a(rt,2);{var Ce=o=>{var n=tr(),c=r(n),S=r(c),I=a(r(S),2);I.__click=Yt,e(S);var h=a(S,2),k=r(h),R=a(r(k),2),at=r(R,!0);e(R),e(k);var C=a(k,2),ot=a(r(C),2),Nt=r(ot,!0);e(ot),e(C);var y=a(C,2),l=a(r(y),2),w=r(l),_=r(w),D=r(_,!0);e(_),e(w);var b=a(w,2),m=r(b),p=r(m,!0);e(m);var T=a(m,2),z=r(T,!0);e(T),e(b),e(l),e(y);var E=a(y,2),U=a(r(E),2),B=r(U),Ot=r(B,!0);e(B),e(U),e(E);var P=a(E,2),st=a(r(P),2),K=r(st,!0);e(st),e(P);var F=a(P,2);{var Vt=M=>{var g=Ze(),O=a(r(g),2),Ht=r(O,!0);e(O),e(g),L(()=>i(Ht,t(d).resourceId)),x(M,g)};V(F,M=>{t(d).resourceId&&M(Vt)})}var A=a(F,2),it=a(r(A),2),Q=r(it,!0);e(it),e(A);var N=a(A,2),lt=a(r(N),2),W=r(lt,!0);e(lt),e(N),e(h);var nt=a(h,2),dt=r(nt);dt.__click=Yt,e(nt),e(c),e(n),L((M,g)=>{i(at,t(d).id),i(Nt,M),i(D,g),i(p,t(d).userName),i(z,t(d).userId),Jt(B,1,`px-2 py-1 text-sm rounded-full ${(X[t(d).action]?.color||"bg-gray-500/20 text-gray-400")??""}`),i(Ot,X[t(d).action]?.label||t(d).action),i(K,Qt[t(d).resourceType]||t(d).resourceType),i(Q,t(d).details),i(W,t(d).ipAddress||"Não disponível")},[()=>ye(t(d).timestamp),()=>t(d).userName.charAt(0).toUpperCase()]),x(o,n)};V(Re,o=>{t(mt)&&t(d)&&o(Ce)})}L(()=>{i(Se,`Total de registros: ${t(vt)??""}`),i(Ae,`Página ${t(u)??""} de ${(t(j)||1)??""}`)}),pe(te,()=>t(H),o=>s(H,o)),pe(ee,()=>t($),o=>s($,o)),Kt(yt,()=>t(G),o=>s(G,o)),Kt(Dt,()=>t(q),o=>s(q,o)),Kt(Rt,()=>t(J),o=>s(J,o)),x(xe,Zt),Be()}Fe(["click"]);export{_r as component};
