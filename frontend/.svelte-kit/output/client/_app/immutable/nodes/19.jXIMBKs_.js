import{f as _,a as m,b as rr}from"../chunks/BVSBLeZ4.js";import{p as Cr,s as c,h as ge,c as l,d as o,t as I,g as e,a as Sr,b as t,j as Er,n as Q,r as s,k as jr}from"../chunks/CyUuy-wj.js";import{d as Rr,e as Mr,s as W}from"../chunks/Ds7I-RoO.js";import{i as M}from"../chunks/B9KgWSyi.js";import{e as Ye,i as Or}from"../chunks/D5Lyc911.js";import{r as u,s as y,b as fe}from"../chunks/BUYgxnM0.js";import{a as Ze,b as C}from"../chunks/BZWVT1Ld.js";import{i as Nr,s as Br}from"../chunks/axbQqOQH.js";import"../chunks/CMByNPU3.js";import{a as er}from"../chunks/DN5HFw78.js";var Dr=rr('<svg class="w-5 h-5 animate-spin" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),Tr=rr('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>'),Ir=_('<button type="button" class="p-1.5 rounded-lg transition-colors" style="color: var(--color-danger);" title="Remover item"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Lr=_("<option> </option>"),Gr=_('<div class="flex items-center gap-2 flex-1 p-2 rounded-lg" style="background-color: var(--bg-tertiary);"><img alt="Comprovante" class="w-10 h-10 object-cover rounded-lg"/> <span class="text-sm truncate flex-1" style="color: var(--text-secondary);"> </span> <button type="button" class="p-1.5 rounded-lg transition-colors" style="color: var(--color-danger);" title="Remover comprovante"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Ar=_('<label class="flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl cursor-pointer transition-all duration-200" style="background-color: var(--bg-tertiary); border: 2px dashed var(--border-color); color: var(--text-muted);"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm">Anexar comprovante</span> <input type="file" accept="image/*" class="hidden"/></label>'),$r=_('<div class="p-4 rounded-xl" style="background-color: var(--bg-secondary); border: 1px solid var(--border-color);"><div class="flex justify-between items-start mb-4"><span class="text-sm font-semibold" style="color: var(--text-secondary);">Item de Gasto</span> <!></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"><div class="form-group md:col-span-2"><label class="modern-label modern-label-required">Descrição</label> <input type="text" class="modern-input" placeholder="Descrição do gasto"/></div> <div class="form-group"><label class="modern-label">Categoria</label> <select class="modern-select"></select></div> <div class="form-group"><label class="modern-label modern-label-required">Valor (R$)</label> <input type="number" step="0.01" min="0" class="modern-input" placeholder="0,00"/></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="form-group"><label class="modern-label">Data do Gasto</label> <input type="date" class="modern-input"/></div> <div class="form-group"><span class="modern-label">Comprovante/Nota Fiscal</span> <div class="flex items-center gap-2"><!></div></div></div></div>'),Fr=_('<div class="modern-alert modern-alert-error animate-in"><svg class="modern-alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),Pr=_('<div class="modern-alert modern-alert-success animate-in"><svg class="modern-alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Relatório de Gastos gerado com sucesso! Download iniciado.</span></div>'),zr=_('<div class="loading-dots"><span></span> <span></span> <span></span></div> <span>Gerando Relatório...</span>',1),qr=_('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg> <span>Gerar Relatório de Gastos</span>',1),Ur=_('<div class="max-w-5xl mx-auto animate-in"><div class="modern-card"><div class="modern-card-header"><div class="modern-card-title"><div class="modern-card-title-icon" style="background: var(--gradient-success);"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> Relatório de Gastos</div> <div class="text-sm" style="color: var(--text-muted);">Prestação de Contas</div></div> <form class="space-y-8"><section><h3 class="text-base font-semibold mb-4 pb-2" style="color: var(--text-primary); border-bottom: 1px solid var(--border-color);">Template</h3> <div class="radio-group"><label class="radio-label"><input type="radio" class="modern-radio"/> <span style="color: var(--text-primary);">NX Energy</span></label> <label class="radio-label"><input type="radio" class="modern-radio"/> <span style="color: var(--text-primary);">SERCAMP</span></label></div></section> <section><h3 class="text-base font-semibold mb-4 pb-2" style="color: var(--text-primary); border-bottom: 1px solid var(--border-color);">Informações Gerais</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-5"><div class="form-group"><label for="osNumber" class="modern-label modern-label-required">Número da OS</label> <div class="flex gap-2"><input id="osNumber" type="text" required class="modern-input flex-1" placeholder="Ex: OS-2024-001"/> <button type="button" class="btn-modern btn-modern-secondary px-3" title="Buscar OS"><!></button></div></div> <div class="form-group"><label for="clientName" class="modern-label modern-label-required">Cliente</label> <input id="clientName" type="text" required class="modern-input" placeholder="Nome do cliente"/></div> <div class="form-group"><label for="reportDate" class="modern-label">Data do Relatório</label> <input id="reportDate" type="date" class="modern-input"/></div> <div class="form-group"><label for="responsible" class="modern-label">Responsável</label> <input id="responsible" type="text" class="modern-input" placeholder="Nome do responsável"/></div> <div class="form-group"><label for="location" class="modern-label">Local</label> <input id="location" type="text" class="modern-input" placeholder="Local do serviço"/></div> <div class="form-group"><label for="periodoInicio" class="modern-label">Período Início</label> <input id="periodoInicio" type="date" class="modern-input"/></div> <div class="form-group"><label for="periodoFim" class="modern-label">Período Fim</label> <input id="periodoFim" type="date" class="modern-input"/></div></div></section> <section><h3 class="text-base font-semibold mb-4 pb-2" style="color: var(--text-primary); border-bottom: 1px solid var(--border-color);">Prestação de Contas</h3> <div class="space-y-4"><!> <button type="button" class="w-full py-3.5 rounded-xl transition-all duration-200 flex items-center justify-center gap-2" style="border: 2px dashed var(--border-color); color: var(--text-muted); background-color: transparent;"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> Adicionar Item de Gasto</button></div> <div class="mt-6 p-4 rounded-xl flex justify-between items-center" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border: 1px solid rgba(16, 185, 129, 0.3);"><span class="text-lg font-medium" style="color: var(--text-secondary);">Total de Gastos:</span> <span class="text-2xl font-bold" style="color: var(--color-success);"> </span></div></section> <section><h3 class="text-base font-semibold mb-4 pb-2" style="color: var(--text-primary); border-bottom: 1px solid var(--border-color);">Observações</h3> <textarea rows="4" class="modern-textarea" placeholder="Observações gerais sobre os gastos..."></textarea></section> <!> <!> <div class="flex flex-col sm:flex-row gap-3 pt-4"><button type="submit" class="btn-modern btn-modern-primary flex-1 py-3.5"><!></button> <button type="button" class="btn-modern btn-modern-secondary py-3.5 sm:w-auto"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span>Limpar</span></button></div></form></div></div>');function ra(ar,or){Cr(or,!0);const _e=[],he="http://localhost:3000/api",tr=[{id:"alimentacao",name:"Alimentação"},{id:"hospedagem",name:"Hospedagem"},{id:"transporte",name:"Transporte"},{id:"combustivel",name:"Combustível"},{id:"pedagio",name:"Pedágio"},{id:"estacionamento",name:"Estacionamento"},{id:"material",name:"Material"},{id:"ferramenta",name:"Ferramenta"},{id:"outros",name:"Outros"}];let E=c("nx_energy"),x=c(""),j=c(""),L=c(ge(new Date().toISOString().split("T")[0])),G=c(""),O=c(""),N=c(""),B=c(""),p=c(ge([P()])),A=c(""),D=c(!1),b=c(null),$=c(!1),F=c(!1);ge(P());function ye(){return`expense_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}function P(){return{id:ye(),descricao:"",categoria:"alimentacao",valor:0,data:new Date().toISOString().split("T")[0],comprovante:null}}const xe=Er(()=>()=>e(p).reduce((r,a)=>r+(a.valor||0),0));function sr(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)}function lr(){t(p,[...e(p),P()],!0)}function ir(r){e(p).length>1&&t(p,e(p).filter(a=>a.id!==r),!0)}function R(r,a,i){t(p,e(p).map(v=>v.id===r?{...v,[a]:i}:v),!0)}async function nr(){if(!e(x).trim()){t(b,"Digite o número da OS para buscar");return}t(F,!0),t(b,null);try{const r=await fetch(`${he}/admin/service-orders?search=${encodeURIComponent(e(x))}`,{headers:{Authorization:`Bearer ${er.token}`}});if(r.ok){const a=await r.json();if(a.length>0){const i=a[0];t(j,i.clientName||"",!0),t(O,i.location||"",!0),i.periodStart&&t(N,i.periodStart.split("T")[0],!0),i.periodEnd&&t(B,i.periodEnd.split("T")[0],!0)}else t(b,"OS não encontrada. Preencha os dados manualmente.")}}catch(r){console.error("Error searching OS:",r)}finally{t(F,!1)}}async function dr(r){if(r.preventDefault(),t(b,null),t($,!1),!e(x).trim()){t(b,"Número da OS é obrigatório");return}if(!e(j).trim()){t(b,"Nome do cliente é obrigatório");return}const a=e(p).filter(i=>i.valor>0&&i.descricao.trim());if(a.length===0){t(b,"Adicione pelo menos um gasto com descrição e valor");return}t(D,!0);try{const i={template:e(E),osNumber:e(x),clientName:e(j),location:e(O),reportDate:e(L),responsible:e(G),periodoInicio:e(N),periodoFim:e(B),expenses:a.map(g=>({descricao:g.descricao,categoria:g.categoria,valor:g.valor,data:g.data,comprovante:g.comprovante})),totalGastos:e(xe)(),observations:e(A)},v=await fetch(`${he}/reports/gastos`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${er.token}`},body:JSON.stringify(i)});if(!v.ok){const g=await v.json();throw new Error(g.message||"Erro ao gerar relatório")}const me=await v.blob(),V=window.URL.createObjectURL(me),h=document.createElement("a");h.href=V,h.download=`relatorio_gastos_${e(x)}_${Date.now()}.docx`,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(V),document.body.removeChild(h),t($,!0),setTimeout(()=>{ke()},2e3)}catch(i){t(b,i instanceof Error?i.message:"Erro ao gerar relatório",!0)}finally{t(D,!1)}}function ke(){t(E,"nx_energy"),t(x,""),t(j,""),t(L,new Date().toISOString().split("T")[0],!0),t(G,""),t(O,""),t(N,""),t(B,""),t(p,[P()],!0),t(A,""),t($,!1),t(b,null)}var Y=Ur(),we=l(Y),Z=o(l(we),2),ee=l(Z),Ce=o(l(ee),2),re=l(Ce),z=l(re);u(z),z.value=z.__value="nx_energy",Q(2),s(re);var Se=o(re,2),q=l(Se);u(q),q.value=q.__value="sercamp",Q(2),s(Se),s(Ce),s(ee);var ae=o(ee,2),Ee=o(l(ae),2),oe=l(Ee),je=o(l(oe),2),te=l(je);u(te);var U=o(te,2);U.__click=nr;var cr=l(U);{var vr=r=>{var a=Dr();m(r,a)},pr=r=>{var a=Tr();m(r,a)};M(cr,r=>{e(F)?r(vr):r(pr,!1)})}s(U),s(je),s(oe);var se=o(oe,2),Re=o(l(se),2);u(Re),s(se);var le=o(se,2),Me=o(l(le),2);u(Me),s(le);var ie=o(le,2),Oe=o(l(ie),2);u(Oe),s(ie);var ne=o(ie,2),Ne=o(l(ne),2);u(Ne),s(ne);var de=o(ne,2),Be=o(l(de),2);u(Be),s(de);var De=o(de,2),Te=o(l(De),2);u(Te),s(De),s(Ee),s(ae);var ce=o(ae,2),ve=o(l(ce),2),Ie=l(ve);Ye(Ie,17,()=>e(p),r=>r.id,(r,a)=>{var i=$r(),v=l(i),me=o(l(v),2);{var V=n=>{var d=Ir();d.__click=()=>ir(e(a).id),m(n,d)};M(me,n=>{e(p).length>1&&n(V)})}s(v);var h=o(v,2),g=l(h),qe=l(g),X=o(qe,2);u(X),X.__input=n=>R(e(a).id,"descricao",n.currentTarget.value),s(g);var ue=o(g,2),Ue=l(ue),k=o(Ue,2);k.__change=n=>R(e(a).id,"categoria",n.currentTarget.value),Ye(k,21,()=>tr,Or,(n,d)=>{var f=Lr(),S=l(f,!0);s(f);var w={};I(()=>{W(S,e(d).name),w!==(w=e(d).id)&&(f.value=(f.__value=e(d).id)??"")}),m(n,f)}),s(k);var He;Nr(k),s(ue);var Ve=o(ue,2),Xe=l(Ve),J=o(Xe,2);u(J),J.__input=n=>R(e(a).id,"valor",parseFloat(n.currentTarget.value)||0),s(Ve),s(h);var Je=o(h,2),be=l(Je),Ke=l(be),K=o(Ke,2);u(K),K.__input=n=>R(e(a).id,"data",n.currentTarget.value),s(be);var Qe=o(be,2),We=o(l(Qe),2),yr=l(We);{var xr=n=>{var d=Gr(),f=l(d),S=o(f,2),w=l(S,!0);s(S);var T=o(S,2);T.__click=()=>R(e(a).id,"comprovante",null),s(d),I(()=>{y(f,"src",e(a).comprovante.data),W(w,e(a).comprovante.name)}),m(n,d)},kr=n=>{var d=Ar(),f=o(l(d),4);f.__change=S=>{const w=S.currentTarget.files?.[0];if(w){const T=new FileReader;T.onload=()=>{const wr={id:ye(),data:T.result,name:w.name};R(e(a).id,"comprovante",wr)},T.readAsDataURL(w)}},s(d),m(n,d)};M(yr,n=>{e(a).comprovante?n(xr):n(kr,!1)})}s(We),s(Qe),s(Je),s(i),I(()=>{y(qe,"for",`expense-desc-${e(a).id??""}`),y(X,"id",`expense-desc-${e(a).id??""}`),fe(X,e(a).descricao),y(Ue,"for",`expense-cat-${e(a).id??""}`),y(k,"id",`expense-cat-${e(a).id??""}`),He!==(He=e(a).categoria)&&(k.value=(k.__value=e(a).categoria)??"",Br(k,e(a).categoria)),y(Xe,"for",`expense-valor-${e(a).id??""}`),y(J,"id",`expense-valor-${e(a).id??""}`),fe(J,e(a).valor),y(Ke,"for",`expense-data-${e(a).id??""}`),y(K,"id",`expense-data-${e(a).id??""}`),fe(K,e(a).data)}),m(r,i)});var mr=o(Ie,2);mr.__click=lr,s(ve);var Le=o(ve,2),Ge=o(l(Le),2),ur=l(Ge,!0);s(Ge),s(Le),s(ce);var pe=o(ce,2),Ae=o(l(pe),2);jr(Ae),s(pe);var $e=o(pe,2);{var br=r=>{var a=Fr(),i=o(l(a),2),v=l(i,!0);s(i),s(a),I(()=>W(v,e(b))),m(r,a)};M($e,r=>{e(b)&&r(br)})}var Fe=o($e,2);{var gr=r=>{var a=Pr();m(r,a)};M(Fe,r=>{e($)&&r(gr)})}var Pe=o(Fe,2),H=l(Pe),fr=l(H);{var _r=r=>{var a=zr();Q(2),m(r,a)},hr=r=>{var a=qr();Q(2),m(r,a)};M(fr,r=>{e(D)?r(_r):r(hr,!1)})}s(H);var ze=o(H,2);ze.__click=ke,s(Pe),s(Z),s(we),s(Y),I(r=>{U.disabled=e(F),W(ur,r),H.disabled=e(D),ze.disabled=e(D)},[()=>sr(e(xe)())]),Mr("submit",Z,dr),Ze(_e,[],z,()=>e(E),r=>t(E,r)),Ze(_e,[],q,()=>e(E),r=>t(E,r)),C(te,()=>e(x),r=>t(x,r)),C(Re,()=>e(j),r=>t(j,r)),C(Me,()=>e(L),r=>t(L,r)),C(Oe,()=>e(G),r=>t(G,r)),C(Ne,()=>e(O),r=>t(O,r)),C(Be,()=>e(N),r=>t(N,r)),C(Te,()=>e(B),r=>t(B,r)),C(Ae,()=>e(A),r=>t(A,r)),m(ar,Y),Sr()}Rr(["click","input","change"]);export{ra as component};
